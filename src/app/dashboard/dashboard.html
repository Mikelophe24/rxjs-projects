<div class="dashboard-container">
  <h1>ğŸ“Š RxJS Dashboard (Realtime Polling)</h1>

  <!-- Control Panel -->
  <div class="control-panel">
    <button class="btn btn-toggle" (click)="togglePause()" [class.paused]="isPaused$ | async">
      {{ (isPaused$ | async) ? 'â–¶ï¸ Resume' : 'â¸ï¸ Pause' }}
    </button>

    <button class="btn btn-refresh" (click)="refresh()" [disabled]="isLoading$ | async">
      ğŸ”„ Refresh Now
    </button>

    <div class="status-indicator">
      <span class="dot" [class.active]="!(isPaused$ | async)"></span>
      <span class="text">
        {{ (isPaused$ | async) ? 'Polling Paused' : 'Auto-refresh every 5s' }}
      </span>
    </div>

    <div class="last-update" *ngIf="lastRefresh$ | async as lastRefresh">
      Last updated: {{ lastRefresh | date : 'HH:mm:ss' }}
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-overlay" *ngIf="isLoading$ | async">
    <div class="spinner"></div>
    <p>Refreshing data...</p>
  </div>

  <!-- Error Message -->
  <div class="error-container" *ngIf="error$ | async as error">
    <p class="error-message">âŒ {{ error }}</p>
    <button class="btn-retry" (click)="refresh()">ğŸ”„ Retry</button>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid" *ngIf="stats$ | async as stats">
    <div class="stat-card card-blue">
      <div class="stat-icon">ğŸ‘¥</div>
      <div class="stat-content">
        <div class="stat-label">Total Users</div>
        <div class="stat-value">{{ stats.totalUsers }}</div>
      </div>
    </div>

    <div class="stat-card card-green">
      <div class="stat-icon">âœ…</div>
      <div class="stat-content">
        <div class="stat-label">Active Users</div>
        <div class="stat-value">{{ stats.activeUsers }}</div>
        <div class="stat-change">
          {{ (stats.activeUsers / stats.totalUsers) * 100 | number : '1.0-0' }}%
        </div>
      </div>
    </div>

    <div class="stat-card card-purple">
      <div class="stat-icon">ğŸ›’</div>
      <div class="stat-content">
        <div class="stat-label">Total Sales</div>
        <div class="stat-value">{{ stats.totalSales }}</div>
      </div>
    </div>

    <div class="stat-card card-orange">
      <div class="stat-icon">ğŸ’°</div>
      <div class="stat-content">
        <div class="stat-label">Today's Revenue</div>
        <div class="stat-value">${{ stats.todayRevenue }}</div>
      </div>
    </div>
  </div>

  <!-- Info Box -->
  <div class="info-box">
    <h3>ğŸ”§ RxJS Operators Used:</h3>
    <ul>
      <li><code>timer(0, 5000)</code> - Emit ngay láº­p tá»©c, sau Ä‘Ã³ má»—i 5 giÃ¢y</li>
      <li><code>switchMap</code> - Switch sang API call má»›i, cancel cÃ¡i cÅ©</li>
      <li><code>retry(3)</code> - Tá»± Ä‘á»™ng retry 3 láº§n náº¿u cÃ³ lá»—i</li>
      <li><code>shareReplay(1)</code> - Cache káº¿t quáº£ vÃ  share cho nhiá»u subscribers</li>
    </ul>

    <h3>ğŸ“š Key Concepts:</h3>
    <ul>
      <li><strong>Polling:</strong> Tá»± Ä‘á»™ng fetch data má»—i 5 giÃ¢y</li>
      <li><strong>Pause/Resume:</strong> Control polling vá»›i BehaviorSubject</li>
      <li><strong>Multicasting:</strong> shareReplay trÃ¡nh duplicate API calls</li>
      <li><strong>Caching:</strong> shareReplay cache káº¿t quáº£ cuá»‘i cÃ¹ng</li>
      <li><strong>Error Handling:</strong> retry + catchError cho production-ready code</li>
      <li><strong>Manual Refresh:</strong> Trigger refresh ngoÃ i polling schedule</li>
    </ul>

    <h3>ğŸ”„ Polling Flow:</h3>
    <div class="flow-diagram">
      <div class="flow-step">timer(0, 5000)</div>
      <div class="arrow">â†“</div>
      <div class="flow-step">Check if paused</div>
      <div class="arrow">â†“</div>
      <div class="flow-step">switchMap â†’ API call</div>
      <div class="arrow">â†“</div>
      <div class="flow-step">retry(3) if error</div>
      <div class="arrow">â†“</div>
      <div class="flow-step">shareReplay(1)</div>
      <div class="arrow">â†“</div>
      <div class="flow-step">Update UI</div>
    </div>

    <h3>ğŸ’¡ Why shareReplay?</h3>
    <div class="comparison">
      <div class="comparison-item bad">
        <strong>âŒ Without shareReplay:</strong>
        <p>3 subscribers = 3 API calls má»—i 5s = Waste!</p>
      </div>
      <div class="comparison-item good">
        <strong>âœ… With shareReplay:</strong>
        <p>3 subscribers = 1 API call má»—i 5s = Efficient!</p>
      </div>
    </div>
  </div>
</div>
