<div class="scroll-container">
  <h1>ğŸ“œ RxJS Infinite Scroll</h1>

  <!-- Posts List -->
  <div class="posts-list">
    @for (post of posts$ | async; track trackByPostId($index, post)) {
      <div class="post-card">
        <div class="post-header">
          <span class="post-id">#{{ post.id }}</span>
          <span class="user-badge">User {{ post.userId }}</span>
        </div>
        <h3 class="post-title">{{ post.title }}</h3>
        <p class="post-body">{{ post.body }}</p>
      </div>
    }
  </div>

  <!-- Loading Indicator -->
  @if (isLoading$ | async) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Loading more posts...</p>
    </div>
  }

  <!-- End of List -->
  @if (!(hasMore$ | async) && !(isLoading$ | async) && (posts$ | async)?.length) {
    <div
      class="end-message"
      >
      <p>ğŸ‰ You've reached the end!</p>
      <p class="total-count">Total posts loaded: {{ (posts$ | async)?.length }}</p>
    </div>
  }

  <!-- Error Message -->
  @if (error$ | async; as error) {
    <div class="error-container">
      <p class="error-message">âŒ {{ error }}</p>
      <button class="btn-retry" (click)="retry()">ğŸ”„ Retry</button>
    </div>
  }

  <!-- Load More Button (fallback) -->
  @if ((hasMore$ | async) && !(isLoading$ | async)) {
    <div class="load-more-container">
      <button class="btn-load-more" (click)="loadMore()">â¬‡ï¸ Load More</button>
      <p class="hint">Or scroll down to auto-load</p>
    </div>
  }

  <!-- Info Box -->
  <div class="info-box">
    <h3>ğŸ”§ RxJS Operators Used:</h3>
    <ul>
      <li>
        <code>exhaustMap</code> - Ignore requests má»›i náº¿u request cÅ© chÆ°a xong (trÃ¡nh duplicate)
      </li>
      <li><code>scan</code> - Accumulate posts tá»« cÃ¡c pages</li>
      <li><code>tap</code> - Side effects (set loading state, logging)</li>
      <li><code>catchError</code> - Handle API errors</li>
    </ul>

    <h3>ğŸ“š FlatMap Operators Comparison:</h3>
    <div class="comparison-table">
      <div class="comparison-row">
        <strong>switchMap</strong>
        <span>Cancel request cÅ©, chá»‰ giá»¯ request má»›i nháº¥t</span>
        <span class="use-case">â†’ Search, Autocomplete</span>
      </div>
      <div class="comparison-row">
        <strong>mergeMap</strong>
        <span>Cháº¡y táº¥t cáº£ requests song song</span>
        <span class="use-case">â†’ Multiple independent API calls</span>
      </div>
      <div class="comparison-row">
        <strong>concatMap</strong>
        <span>Cháº¡y tuáº§n tá»±, Ä‘á»£i request trÆ°á»›c xong má»›i cháº¡y tiáº¿p</span>
        <span class="use-case">â†’ Sequential operations</span>
      </div>
      <div class="comparison-row highlight">
        <strong>exhaustMap</strong>
        <span>Ignore requests má»›i náº¿u Ä‘ang xá»­ lÃ½</span>
        <span class="use-case">â†’ Infinite Scroll, Button clicks</span>
      </div>
    </div>

    <h3>ğŸ’¡ Key Concepts:</h3>
    <ul>
      <li><strong>Scroll Detection:</strong> HostListener Ä‘á»ƒ detect window scroll</li>
      <li><strong>Threshold:</strong> Load trÆ°á»›c 200px Ä‘á»ƒ UX mÆ°á»£t hÆ¡n</li>
      <li><strong>State Management:</strong> BehaviorSubject quáº£n lÃ½ pagination state</li>
      <li><strong>Prevent Duplicates:</strong> exhaustMap + isLoading check</li>
    </ul>
  </div>
</div>
